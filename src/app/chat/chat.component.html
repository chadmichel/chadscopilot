<div class="chat-container">
  <div class="messages" #messagesContainer>
    @if (chatService.getMessages(workspaceId).length === 0) {
      <div class="empty-state">
        <svg class="empty-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <h2>Start a conversation</h2>
        <p>Ask anything &mdash; powered by GitHub Copilot</p>
      </div>
    }

    @for (msg of chatService.getMessages(workspaceId); track $index) {
      <div class="message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
        <div class="message-avatar" [class.user-avatar]="msg.role === 'user'" [class.assistant-avatar]="msg.role === 'assistant'">
          @if (msg.role === 'user') {
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          } @else {
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
              <path d="M2 17l10 5 10-5"/>
              <path d="M2 12l10 5 10-5"/>
            </svg>
          }
        </div>
        <div class="message-body">
          <div class="message-role">{{ msg.role === 'user' ? 'You' : 'Copilot' }}</div>
          <div class="message-text" [innerHTML]="msg.content | markdown"></div>
        </div>
      </div>
    }

    @if (isLoading && !chatService.getIsStreaming(workspaceId)) {
      <div class="message assistant">
        <div class="message-avatar assistant-avatar">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            <path d="M2 17l10 5 10-5"/>
            <path d="M2 12l10 5 10-5"/>
          </svg>
        </div>
        <div class="message-body">
          <div class="message-role">Copilot</div>
          <div class="typing-indicator">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="input-area">
    <div class="input-wrapper">
      <textarea
        [(ngModel)]="userInput"
        (keydown)="onKeyDown($event)"
        placeholder="Ask Copilot anything..."
        rows="1"
        [disabled]="isLoading"
      ></textarea>
      <button
        (click)="sendMessage()"
        [disabled]="!userInput.trim() || isLoading"
        class="send-button"
        aria-label="Send message">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13"/>
        </svg>
      </button>
    </div>
  </div>
</div>
