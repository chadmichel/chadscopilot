<div class="app-layout" [class.sidebar-collapsed]="sidebarCollapsed">
  <!-- Mobile backdrop + drawer sidebar -->
  <div
    *ngIf="isAuthenticated && isMobile && mobileNavOpen"
    class="mobile-nav-backdrop"
    (click)="closeMobileNav()"
  ></div>

  <div
    *ngIf="isAuthenticated && isMobile && mobileNavOpen"
    class="mobile-drawer"
  >
    <app-sidebar
      [menuSections]="sidebarMenuSections"
      [userInfo]="sidebarUserInfo"
      [syncLabel]="syncLabel"
      [syncState]="syncState"
      [collapsed]="mobileSidebarCollapsed"
      (collapsedChange)="onMobileSidebarCollapsedChange($event)"
      (userClicked)="showUserMenu($event)"
    ></app-sidebar>
  </div>

  <!-- Desktop Sidebar Navigation -->
  <app-sidebar
    *ngIf="isAuthenticated && !isMobile"
    [menuSections]="sidebarMenuSections"
    [userInfo]="sidebarUserInfo"
    [syncLabel]="syncLabel"
    [syncState]="syncState"
    [(collapsed)]="sidebarCollapsed"
    (userClicked)="showUserMenu($event)"
  ></app-sidebar>

  <!-- Main Content Area -->
  <div class="main-area" [class.no-sidebar]="!isAuthenticated">
    <!-- Mobile Header (only on mobile) -->
    <header class="mobile-header" *ngIf="isAuthenticated">
      <button 
        class="mobile-menu-btn"
        (click)="toggleMobileSidebar()"
      >
        <i class="pi pi-check-square"></i>
      </button>
      <span class="mobile-title">WhenIsDone</span>
      <div class="mobile-sync" [class]="'state-' + syncState" title="{{ syncLabel }}">
        <span class="dot"></span>
        <span class="label">{{ syncLabel }}</span>
      </div>
    </header>

    <!-- Page Content -->
    <main class="page-content">
      <router-outlet></router-outlet>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
      <div class="footer-content">
        <span>&copy; {{ currentYear }} WhenIsDone</span>
        <span class="version">v{{ version }}</span>
      </div>
    </footer>
  </div>

  <!-- User Menu Overlay -->
  <p-menu #userMenu [model]="profileItems" [popup]="true"></p-menu>
</div>
